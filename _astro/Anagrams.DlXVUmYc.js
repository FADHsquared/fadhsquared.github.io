import{c as f,a as _,u as S,b as Z,d as Q,o as O,e as F,g as p,i as v,f as E,h as ee,r as B,t as b,j as k,k as R,s as W,l as te,F as ne}from"./web.Cdr1opmF.js";import{u as re,l as ae}from"./use-has-mounted.C5hZsWfM.js";var se={equals:!1},oe=e=>typeof e=="function"&&!e.length?e():e;function ce(e,...t){return typeof e=="function"?e(...t):e}var le=(e,t)=>e.length>0?()=>e(S(t)):e;function ie(e,t){let a=0;const n=e.map((s,r)=>_(()=>(a=r,s()),void 0,se));return _(()=>n.map(s=>s())[a],void 0,t)}function de(e,t,a){let n=()=>t;const[s,r]=f(t),c=_(le(e,()=>n()),t);return[n=ie([s,c],a),m=>r(()=>typeof m=="function"?m(S(n)):m)]}var C=(e,t,a)=>{const n=a(e,t);return O(()=>clearInterval(n))},ue=(e,t,a)=>{if(typeof t=="number"){C(e,t,a);return}let n=!1,s=performance.now(),r=0,c=!1;const m=()=>{S(e),s=performance.now(),n=a===setTimeout};Q(d=>{if(n)return;const g=t();if(g===!1)return d&&(r+=(performance.now()-s)/d),g;if(d===!1&&(s=performance.now()),c){if(d&&(r+=(performance.now()-s)/d),s=performance.now(),r>=1)r=0,m();else if(r>0){const[h,T]=f(void 0,{equals:!1});return h(),C(()=>{r=0,c=!1,T(),m()},(1-r)*g,setTimeout),g}}return c=!0,C(m,g,a),g})};function fe(e,t,a,n){const[s,r]=f(S(e.bind(void 0,a)),n),c=()=>r(e);return ue(c,t,setInterval),Z(c),s}var G=6e4,I=36e5,U=e=>e instanceof Date?e:new Date(e),me=(e,t)=>t.getTime()-e.getTime(),A=e=>{const[t,a]=de(()=>U(oe(e)));return[t,s=>a(r=>U(ce(s,r)))]};function ge(e=G/2){const[t,a]=f(void 0,{equals:!1});return[fe(()=>(t(),new Date),e,void 0,{equals:(s,r)=>s.getTime()===r.getTime()}),a]}function pe(e,t){const[a]=A(e),[n]=A(t);return[_(()=>me(a(),n())),{from:a,to:n}]}function ve(e,t=a=>Math.abs(a)<=I?G/2:I/2){const a=typeof t=="function"?()=>t(r()):t,[n,s]=ge(a),[r,{to:c}]=pe(n,e);return[r,{update:s,target:c,now:n}]}var be=(e,t,a=[])=>{const n=new WebSocket(e,t),s=n.send.bind(n);return n.send=r=>n.readyState==1?s(r):a.push(r),n.addEventListener("open",()=>{for(;a.length;)s(a.shift())}),n},he=b("<button>");function _e(e){return(()=>{var t=p(he);return t.$$click=()=>e.onClick?.(),v(t,()=>e.children),E(()=>ee(t,`w-full rounded-lg border-[3px] border-[#CF5C36] px-2 py-1
        font-semibold transition duration-100 hover:bg-[#CF5C36]
        hover:text-white active:scale-95 ${e.class??""}`)),B(),t})()}F(["click"]);var $e=b("<label for=server-url class=select-none>Server URL (Connection:<!$><!/>)"),we=b('<input id=server-url type=text class="w-full rounded-lg border-2 border-slate-300 bg-transparent dark:border-slate-600">'),Se=b('<div class="mb-2 flex flex-col items-center rounded-lg bg-slate-100 p-2 dark:bg-slate-700"><p class="font-mono text-sm font-bold"><!$><!/> - <!$><!/></p><code class=text-4xl>'),Te=b('<div class="h-60 overflow-y-auto whitespace-pre-wrap break-all rounded-lg bg-slate-200 p-2 dark:bg-slate-700 sm:h-96">'),xe=b('<input type=text placeholder="message/answer here, send with Enter"class="mt-2 w-full rounded-lg border-2 border-slate-300 bg-transparent dark:border-slate-600">'),ke=b("<div>");function Ne(){const[e,t]=ae,a=()=>e["anagrams-server-url"]??"wss://wordgames4j.azurewebsites.net/ws/anagram/1",[n,s]=f("Not Connected");let r,c;O(()=>{r&&r.close()});const[m,d]=f("WAITING ROUND START!"),[g,h]=f(""),[T,$]=f(""),[N]=ve(T,()=>100),[w,D]=f(""),[H,y]=f([]),L=o=>{const{type:l,content:i}=JSON.parse(o.data);switch(l){case"ChatMessage":y(u=>[...u,i]),setTimeout(()=>{c&&(c.scrollTop=c.scrollHeight)});break;case"OngoingRoundInfo":$(i.round_finish_time),d("PLEASE GUESS!"),h(i.word_to_guess);break;case"FinishedRoundInfo":$(i.to_next_round_time),d("TIME'S UP! THE ANSWER:"),h(i.word_answer);break;case"FinishedGame":$(""),d("WAITING ROUND START!"),h("")}},M=()=>{s("Open")},P=()=>{n()==="Not Connected"||n()==="Closed"?(r=be(a()),s("Connecting"),r.addEventListener("open",M),r.addEventListener("message",L)):(s("Closing"),r?.removeEventListener("open",M),r?.removeEventListener("message",L),r?.close(),s("Closed"),$(""),d("WAITING ROUND START!"),h(""))},q=o=>{o.key==="Enter"&&(w()==="/clear"?y([]):w().trim()!==""&&r?.send(w()),D(""))},j=re();return[(()=>{var o=p($e),l=o.firstChild,i=l.nextSibling,[u,x]=k(i.nextSibling);return u.nextSibling,v(o,n,u,x),o})(),(()=>{var o=p(we);return o.addEventListener("change",l=>t("anagrams-server-url",l.currentTarget.value)),E(()=>W(o,"value",j()?a():"Loading saved URL...")),o})(),R(_e,{class:"my-2",onClick:P,get children(){return typeof n<"u"&&n()==="Open"?"Disconnect":"Connect"}}),(()=>{var o=p(Se),l=o.firstChild,i=l.firstChild,[u,x]=k(i.nextSibling),z=u.nextSibling,J=z.nextSibling,[K,V]=k(J.nextSibling),X=l.nextSibling;return v(l,m,u,x),v(l,(()=>{var Y=_(()=>!!isNaN(N()));return()=>Y()?"":`${Math.max(0,N()/1e3).toFixed(1)} secs`})(),K,V),v(X,g),o})(),(()=>{var o=p(Te),l=c;return typeof l=="function"?te(l,o):c=o,v(o,R(ne,{get each(){return H()},children:i=>(()=>{var u=p(ke);return v(u,i),u})()})),o})(),(()=>{var o=p(xe);return o.addEventListener("change",l=>D(l.currentTarget.value)),o.$$keyup=q,E(()=>W(o,"value",w())),B(),o})()]}F(["keyup"]);export{Ne as default};
